#!/usr/bin/env bash
set -euo pipefail

PAYLOAD_PREFIX="__AI_PAYLOAD__"
session="$(tmux display-message -p '#S' 2>/dev/null || true)"
payload=$(tmux list-windows -F '#{window_index}::#{window_name}::#{?window_active,1,0}' | base64 -w 0)

if [ -n "$session" ]; then
  tmux set-option -t "$session" -q @ai_payload "${PAYLOAD_PREFIX}windows::${payload}"
else
  tmux set-option -gq @ai_payload "${PAYLOAD_PREFIX}windows::${payload}"
fi
tmux refresh-client -S
